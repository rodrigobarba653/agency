"use client";

import { useRef, useEffect } from "react";
import { gsap } from "gsap";

interface FrameProps {
  className?: string;
  animateOnScroll?: boolean;
  sectionRef?: React.RefObject<HTMLElement | null>;
  delay?: number;
}

export default function Frame({
  className = "",
  animateOnScroll = true,
  sectionRef,
  delay = 0,
}: FrameProps) {
  const framePathRef = useRef<SVGPathElement>(null);

  // Animate frame path on scroll into view
  useEffect(() => {
    if (!animateOnScroll || !framePathRef.current) return;

    const framePath = framePathRef.current;
    let observer: IntersectionObserver | null = null;

    // Set up the path for animation
    const pathLength = framePath.getTotalLength();

    // Initialize the path as hidden
    gsap.set(framePath, {
      strokeDasharray: pathLength,
      strokeDashoffset: pathLength,
    });

    // Function to animate the frame
    const animateFrame = () => {
      gsap.to(framePath, {
        strokeDashoffset: 0,
        duration: 2,
        delay: delay,
        ease: "power2.out",
      });
    };

    if (sectionRef?.current) {
      // Use provided section ref for intersection observer
      observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              // Reset and animate
              gsap.set(framePath, {
                strokeDashoffset: pathLength,
              });
              requestAnimationFrame(() => {
                animateFrame();
              });
            }
          });
        },
        {
          threshold: 0.2,
          rootMargin: "0px",
        }
      );

      observer.observe(sectionRef.current);

      // Animate on initial mount if already in view
      const rect = sectionRef.current.getBoundingClientRect();
      const windowHeight = window.innerHeight;
      if (rect.top < windowHeight && rect.bottom > 0) {
        animateFrame();
      }
    } else {
      // If no section ref, animate immediately
      animateFrame();
    }

    return () => {
      if (observer) {
        observer.disconnect();
      }
    };
  }, [animateOnScroll, sectionRef, delay]);

  return (
    <svg
      id="Layer_1"
      xmlns="http://www.w3.org/2000/svg"
      version="1.1"
      viewBox="0 0 521 413"
      className={className}
    >
      <defs>
        <style>
          {`.st0 {
            fill: none;
            stroke: #fff;
          }`}
        </style>
      </defs>
      <path
        ref={framePathRef}
        className="st0"
        d="M352.8,54.3c28.5-7.8,55.1-21.7,77.3-40.2-16.9,11.2-25.8,32.2-21.7,51.4,22.5-5.5,41.9-21.1,51.3-41.2-9.7,12.7-13.6,29.1-10.6,44.5,14.9-9.3,23.4-26.9,21.1-43.6-5.8,10.9-9.4,22.9-10.3,35.2-.4,5.4,0,11.4,3.7,15.5,4.1,4.4,10.9,5.2,17,5.1,14.2-.2,28.3-4.1,40.4-11.2-20.3.5-40.5,3.8-59.7,9.7,17.7.8,35.4,1.7,53.1,2.5-8.4,6.1-16.9,12.2-25.3,18.2,8.3-.3,16.7-.6,25-.9-20.2,11.4-14.5,28-36.2,36.5,14.4.5,28.7.9,43.1,1.4-5.4,14.1-18.6,25.3-34,29,.9-23.6-22.5-53.8-16.9-76.8,6.4,9.2,33,27.7,32.1,38.7-2.1,27.1-6.8,53.9-13.9,80.2,7.7-4.1,15.4-8.2,23.1-12.4-18.8,11.4-36.3,24.7-52.1,39.6l2.7,6.5c23.3-.1,19.9-6.9,43.2-7-21.9,12.7-18.2,30.3-42,39.4l39-5.5c-9.8,10.2-19.6,20.3-29.3,30.5,13.6-3.3,27.3-6.6,40.9-9.9-6.1,17.1-16.2,32.8-29.4,45.8,7.4-3.1,14.9-6.2,22.3-9.3-17.8,19.5-36.3,38.4-55.4,56.8,17.1-4.5,33.1-12.7,46.4-23.8-9.4,20.5-60.3,27.5-83.9,25.6,5.4-21-34,16.8-21.9-1.6-7.1,17.2,25.3-27.9,7.4-20.4-17.9,7.5-37.6,10.1-57.1,11.7,1.8-9.6,7.7-18.4,16.1-24-1.3,17.5-16.2,33.4-34.4,36.7-9-11-16.3-23.2-21.8-36.1,2.2,8.4,1.9,17.3-.9,25.6-8.8-8.4-16.8-17.6-23.9-27.4,0,10.2,2.4,20.4,6.7,29.7-8.9-8.7-21-14.5-33.8-16.2,7.4,11-2.2,27.3-15.8,29.4s-27.1-8.1-30.8-20.6c-3.7-12.5,1-26.3,9.4-36.6-6,29.5-37.3,47.4-66.5,59.3-2.7-3.1.5-7.6,3.7-10.3,14.1-11.7,30.2-21.2,47.5-28.1-28.4,24.3-71.6,32.2-107.6,19.5,2.6-8.9,11-16,20.7-17.5-18.9,10.4-39,18.7-59.9,24.7-5-13.5-4-28.9,2.6-41.8,5.2,13.2,11.7,26.1,19.3,38.2-8.2-18.1-16.4-36.1-24.7-54.2,6,6.6,11.1,13.8,15.2,21.5-10.2-14-15.1-31.4-13.6-48.3,5.9,18.2,8,37.5,6.3,56.4-21.2-27.5-37.8-58.1-49-90.3,23.5,21.4,41.5,48.1,51.9,77.3-22.6-16.5-46.1-34.2-57.1-59.1,26.5,27.4,36.3,68.2,24.9,103.7-7.1-47.4-4.7-95.9,6.9-142.5,2.2-8.8,5.1-18.2,12.6-23.9,11.7,21.9,19.8,45.5,23.9,69.8-22.5-29.1-42.4-60-59.4-92.2,23,15.7,43.1,35.2,59,57.4-15.5-15.1-29.5-31.4-41.8-48.9-4.2-5.9-8-14.1-3.2-19.5,13.5,16.5,19.4,38.4,15.9,59C15.5,214.6.9,176.4,0,137.8c10.3-5.1,23.7-1.7,32.2,5.9,8.5,7.5,12.8,18.4,15,29.2-13.1-22.4-19.7-48.3-18.8-73.9,16.1,15.3,27.5,35,32.6,56-17.2-27.8-31.6-57.2-43.2-87.5,7.6,12.1,13.9,25,18.6,38.4-8-21.4-13.1-43.8-15.2-66.4,15.2,1.7,27.5,16.1,26.1,30.5.7-19.7,6.6-39.2,16.8-56.4,1.3,14.6.3,29.4-3,43.7,9.9-15.1,24.6-27.4,41.6-34.9-4.4,11.3-10.6,22-18.5,31.5,18.3-10.4,38.5-17.8,59.4-22l2.8,6.5c-5.1,5.3-10.8,10.1-17,14.2,22.1-9.1,46-14.4,70-15.5l2.7,6.8c-11.6,8.2-24.7,14.7-38.5,19-2.5-2.6.5-6.7,3.4-8.9,19.5-14.9,43.5-24.4,68.5-27-8.4,13.7-20,25.5-33.9,34.5,11.5-18,26.8-33.8,44.7-46.2,1.3,10.3.5,20.9-2.3,30.9,12.6-13,29.1-22.5,47-27-1.8,9.8-3.7,19.6-5.5,29.4,12.4-7.5,24.8-15,37.2-22.5,3.6,9.5,6.7,19.2,9.1,29,11.7-7.7,22-17.3,30.4-28.1,3.3,3.6,5.1,8.4,4.9,13.2-5.3,4.8-13.7,4.5-20.9,3.5-34.6-4.7-67.9-17.7-95.9-37.3,12.1,14.7,21.6,31.3,27.8,49-30.1-12.4-57-31.5-78-55.3,6.6,14.4,7.3,31.2,1.8,46.1-10.7-15.2-21.5-30.4-32.2-45.7,3.8,16.8,6.9,36.4-5.1,49.3-17.7-10.8-33.3-24.4-46.2-40.2,4.9,9.2,7.5,19.4,7.5,29.7-11-1.5-21.8-5.2-31.2-10.7,1.8,7.3,0,15.4-5,21.3-18.3-6.7-35.3-16.5-50-28.9,10.7,16.5,15.9,36.2,14.8,55.5-13.8,8.9-35.2,4.7-44-8.7,14.9,25.2,25,53,29.7,81.5-6.8-.5-13-5.6-14.5-11.9,13,10.5,18.4,28.5,13.3,43.8-4.8-19.5-9.6-38.9-14.4-58.4-.8,8.2-4,16.1-9.1,22.7"
      />
    </svg>
  );
}

